---
title: "CS109b Final Project Milestone 3"
author: "Phillip Huang"
date: "4/19/2017"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, cache=TRUE)
```

```{r}
library("caTools")
library("utiml")
library("corrplot")
```


```{r}
## PREPARE DATA ##

# load data
imdb5k <- read.csv('imdb5konehot.csv')

# drop categoricals
imdb5k <- imdb5k[, sapply(imdb5k, is.numeric)]

# impute all columns by column mean
for(i in 1:ncol(imdb5k)){
    imdb5k[is.na(imdb5k[,i]), i] <- mean(imdb5k[,i], na.rm = TRUE)
}

# create MLDR object
imdb5k.mldr <- mldr_from_dataframe(dataframe=imdb5k, labelIndices=which(startsWith(colnames(imdb5k), "i_")))

# train-test split
ds <- create_holdout_partition(imdb5k.mldr, c(train=0.80, test=0.20))
```


```{r}
## BINARY RELEVANCE ##

# binary relevance with random forests
br.model <- br(ds$train, "RF", cores=2)

# predict
prediction.br <- predict(br.model, ds$test)

# evaluate binary relevance
br.result <- multilabel_evaluate(ds$tes, prediction.br, "bipartition")
```

```{r}
## ENSEMBLE OF CLASSIFIER CHAINS ##

# ecc with random forests
ecc.model <- ecc(ds$train, "RF", cores=2)

# predict
prediction.ecc <- predict(ecc.model, ds$test)

# evaluate binary relevance
ecc.result <- multilabel_evaluate(ds$tes, prediction.ecc, "bipartition")
```

```{r}
## RAKEL ##

# RAKEL with random forests
rakel.model <- rakel(ds$train, "RF", cores=2)

# predict
prediction.rakel <- predict(rakel.model, ds$test)

# Evaluate the models
rakel.result <- multilabel_evaluate(ds$tes, prediction.rakel, "bipartition")
```

```{r}
## EPS ##

# EPS with random forests
eps.model <- eps(ds$train, "RF", cores=2)

# predict
prediction.eps <- predict(eps.model, ds$test)

# Evaluate the models
eps.result <- multilabel_evaluate(ds$tes, prediction.eps, "bipartition")
```


```{r}
## HOMER ##

# HOMER with random forests
homer.model <- homer(ds$train, "RF", cores=2)

# predict
prediction.homer <- predict(homer.model, ds$test)

# Evaluate the models
homer.result <- multilabel_evaluate(ds$tes, prediction.homer, "bipartition")
```

```{r}
# print results
result <- cbind(
  br = br.result,
  ecc = ecc.result,
  rakel = rakel.result,
  eps = eps.result,
  homer = homer.result
)

print(round(result, 3))
```
```{r}
corrplot(result, method="color")
```


